<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Dom Expressions</title>
  <link rel="stylesheet" href="style/base.css">
  <link rel="stylesheet" href="style/main.css">
  <script src="../dist/domex.js"></script>
</head>
<body>
</head>
<body>
<h1>Dom Expression Language</h1>
<script>
const log = console.log.bind (console)
const dobo = document.body
const { DomEx, dom } = modules.domex;

// log(
//   dom `ul > (li %)*` ([1,2,3]) .elem .outerHTML,
//   dom `dl > (dt $ + dd %)*` ({ foo:1, bar:2 }) .elem .outerHTML,
// )

const domIndex = Symbol('domIndex')
function Dom (source, data) {
  const build = new DomEx (source) .render (data)
  build.elem [domIndex] = build
  return build.elem
}

const buttons = ['prev', 'now', 'next']
let view = Dom ('div > button%*', buttons)

view.addEventListener ('click', evt => {
  log ('click from', evt.currentTarget[domIndex], evt.target)
})

document.body.append (view)

// Example - Recursive expressions
// -------------------------------

const Menu = new DomEx (`ul > (li > a $ + Menu?object)*`)

const Json = new DomEx (`
    span .number    ?number    %
  | span .null      ?null      {null}
  | span .undefined ?undefined {undefined}
  | span .boolean   ?boolean   %
  | span .string    ?string    %
  | ul   .array     ?array     > (li > Json)*
  | dl   .object    ?object    > span {object} + (di > dt $ + dd > Json)*
  | span .function  ?function  {function } %name
  //| span .unknown              %`)

log (Json.ast)
// Precedence from low to high:
// |, <, +, 

const lib = { Menu, Json }
const sample = { one:1, two:2, three: {foo:4, bar:5}, ux:null, ar:[1,{x:2, y:false, z:null},3, undefined, dom] }

// const menu = lib.Menu.render (sample, lib)
// dobo.append (menu.elem)

const json = lib.Json.render (sample, lib)
dobo.append (json.elem)

json.elem.addEventListener ('click', evt => {
  // So now you have access to a number of related items,
  // the target root element, the target element and for each of those,
  // the model-key and the model. 
  // That's already _very_ powerful.
  // But it might be good to also access the refs from here. 
  const root = evt.currentTarget
  const elem = evt.target
  const key = elem[DomEx.key]
  const model = elem[DomEx.model]
  log ({ root, elem, model, key })
})

</script>
</body>
</html>
