<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Dom Expressions</title>
  <link rel="stylesheet" href="style/base.css">
  <link rel="stylesheet" href="style/main.css">
  <script src="../dist/domex.js"></script>
</head>
<body>
</head>
<body>

<h1>Dom Expression Language</h1>

<script id=dx1 type="domex">

  // lib

  form @login
    > (h1 > "Login")
    + ( @input ~modified :modified
      | @input ~pristine :pristine
      | @input
      )
    + (button > "login");

  label @input
    > "name"
    + input [name=name value=%name];
  
  // main

  @login + @default

</script>

<script>
const log = console.log.bind (console)
const dobo = document.body
const $ = document.getElementById.bind (document)
const { domex, Domex } = modules.domex

// Bugs bugs bugx


const sample = domex `
  ( h1 > "Hello, World" )
  + p > "This is domex :)"
`

const sampleData = {
  name: 'jack',
  foo: 1,
  bar: [ 1, 2, [4, 5], "foo", null, undefined, NaN ],
  obj: { 
    x: 1,
    y: 'z',
    sym: Symbol('hi')
  },
  fn: document.createElement
}

const dx1 = new Domex ($('dx1').firstChild.data)
dx1.prepareData = function (data, key) {
  return { modified:null, pristine:data }
}

const dx2 = domex `@login` .withLib ({'@login': dx1 })

dobo.append (sample.render().elems, dx2.render (sampleData) .elems)



window.addEventListener ('click', evt => {
  let elem = evt.target
  do {
    if (Domex.refKey in elem) return log (elem[Domex.refKey])
    elem = elem.parentNode
  }
  while (elem)
})


</script>
</body>
</html>
